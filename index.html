<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz : Les Feux Follets & La Ph√©nylc√©tonurie</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-orange: #f39200;
            --secondary-yellow: #ffc107;
            --dark-blue: #003a5d;
            --light-bg: #fdfaf6;
            --correct-green: #28a745;
            --wrong-red: #dc3545;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .quiz-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 30px;
            text-align: center;
            border-top: 8px solid var(--primary-orange);
            position: relative;
        }

        h1 {
            color: var(--dark-blue);
            font-size: 1.8em;
            margin: 0 0 10px 0;
        }

        h2 {
            color: var(--dark-blue);
            font-size: 1.5em;
            margin: 0 0 15px 0;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        /* Accueil et QR */
        .welcome-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qr-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            border: 2px dashed var(--primary-orange);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: fit-content;
        }

        .qr-box img {
            max-width: 180px;
            height: auto;
            display: block;
        }

        .qr-instruction {
            font-size: 0.9em;
            color: var(--dark-blue);
            margin-top: 10px;
            font-weight: bold;
        }

        /* Quiz */
        .question {
            font-size: 1.3em;
            font-weight: bold;
            margin: 30px 0 20px 0;
            color: var(--dark-blue);
            min-height: 60px;
            line-height: 1.4;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 25px 0;
        }

        .option-btn {
            background-color: white;
            border: 2px solid var(--primary-orange);
            color: var(--dark-blue);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease-in-out;
            position: relative;
            text-align: left;
        }

        .option-btn:not(:disabled):hover {
            background-color: var(--secondary-yellow);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* Couleurs et Animations de r√©ponse */
        .option-btn.correct {
            background-color: var(--correct-green) !important;
            color: white !important;
            border-color: var(--correct-green) !important;
        }
        
        .option-btn.animate-correct {
            animation: pulse-green 0.6s ease-out;
        }

        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 15px var(--correct-green); }
            100% { transform: scale(1); }
        }

        .option-btn.incorrect {
            background-color: var(--wrong-red) !important;
            color: white !important;
            border-color: var(--wrong-red) !important;
        }

        .option-btn.animate-incorrect {
            animation: shake-red 0.5s ease-in-out;
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px); }
            40%, 80% { transform: translateX(6px); }
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .action-btn {
            background-color: var(--dark-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            margin-top: 20px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover:not(:disabled) {
            background-color: #00223e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .hidden { 
            display: none !important; 
        }

        .trophy { 
            font-size: 100px; 
            margin: 20px 0; 
            display: block;
        }

        input[type="text"] {
            padding: 12px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 85%;
            margin: 15px auto;
            display: block;
            transition: 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--primary-orange);
            outline: none;
            box-shadow: 0 0 5px rgba(243, 146, 0, 0.3);
        }
        
        .progress {
            font-size: 0.9em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .firebase-status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-success {
            background-color: #efe;
            color: #060;
            border-left: 4px solid #060;
        }

        .status-error {
            background-color: #fee;
            color: #c00;
            border-left: 4px solid #c00;
        }

        .firebase-save-block {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 25px;
            border: 2px solid #eee;
        }

        .firebase-save-block p {
            margin-top: 0;
            font-weight: bold;
            color: var(--dark-blue);
        }

        #next-btn {
            margin-top: 25px;
        }

        .btn-secondary {
            background-color: #666;
        }

        .btn-secondary:hover {
            background-color: #555;
        }

        /* Barre de logos partenaires ‚Äì disposition verticale */
        .logo-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0e8dc;
            width: 100%;
        }

        .logo-bar .logo-plemara {
            max-height: 110px;
            max-width: 80%;
            object-fit: contain;
        }

        .logo-bar .logo-ffx {
            max-height: 110px;
            max-width: 80%;
            object-fit: contain;
        }

        .logo-bar .logo-title {
            font-size: 1.15em;
            font-weight: bold;
            color: var(--dark-blue);
            text-align: center;
            line-height: 1.4;
            margin: 4px 0 0 0;
        }

        .logo-bar .logo-date-text {
            font-size: 1em;
            color: var(--primary-orange);
            text-align: center;
            font-weight: bold;
            margin: 0;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
                align-items: flex-start;
            }
            .quiz-container {
                padding: 18px 14px;
                border-radius: 10px;
            }
            .logo-bar .logo-plemara,
            .logo-bar .logo-ffx {
                max-height: 80px;
                max-width: 70%;
            }
            .logo-bar .logo-title {
                font-size: 1em;
            }
            h1 {
                font-size: 1.4em;
            }
            .question {
                font-size: 1.05em;
            }
            .option-btn {
                padding: 12px;
                font-size: 0.92em;
            }
            input[type="text"] {
                width: 95%;
            }
        }
    </style>
</head>
<body>

<div class="quiz-container">

    <!-- BARRE DE LOGOS -->
	<div class="logo-bar">
	    <img class="logo-plemara" src="Logo-PLEMaRa.png" alt="PLEMaRa ‚Äì Plateforme d'Expertise Maladies Rares des Hauts-de-France">
	    <p class="logo-title">üéóÔ∏è Journ√©e internationale des maladies rares</p>
	    <p class="logo-date-text">28 f√©vrier 2026</p>
	    <img class="logo-ffx" src="Logo-FFx.png" alt="Les Feux Follets">
	</div>


    <!-- √âCRAN D'ACCUEIL -->
    <div id="welcome-block">
        <h1>üèÜ Quiz Les Feux Follets üèÜ</h1>
        <p class="h2">Testez vos connaissances</p>
        
        <div class="welcome-content">
            <div class="qr-box">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://sebastienblervacque-bot.github.io/quiz-feux-follets/" alt="QR Code du Quiz">
                <p class="qr-instruction">üì± Scannez pour jouer sur votre mobile !</p>
            </div>

            <p>sur la ph√©nylc√©tonurie et l'association !</p>
            <button class="action-btn" onclick="startQuiz()">üöÄ Commencer le Quiz</button>
        </div>
    </div>

    <!-- BLOC QUIZ -->
    <div id="quiz-block" class="hidden">
        <div class="progress" id="progress-text">Question 1 / 10</div>
        <div class="question" id="question-text">Chargement...</div>
        <div class="options" id="options-container"></div>
        <button id="next-btn" class="action-btn" style="display: none;" onclick="nextQuestion()">Question suivante ‚ûî</button>
    </div>

    <!-- BLOC R√âSULTATS -->
    <div id="result-block" class="hidden">
        <h2>üéä Quiz Termin√© !</h2>
        <div class="trophy" id="trophy-emoji">üèÜ</div>
        <h1 id="score-final">Score: 0/10</h1>
        <p id="feedback-text" style="font-size: 1.1em; margin: 20px 0;"></p>
        
        <div class="firebase-save-block">
            <p>üìä Inscrire mon score au tableau d'honneur :</p>
            <input type="text" id="player-name" placeholder="Votre pr√©nom ou pseudo" maxlength="50">
            <button id="save-btn" class="action-btn" onclick="saveScoreToFirebase()">üíæ Sauvegarder le score</button>
            <div id="save-status" style="margin-top: 10px;"></div>
        </div>
        <button class="action-btn btn-secondary" style="margin-top: 20px;" onclick="location.reload()">üîÑ Rejouer</button>
    </div>
</div>

<script>
    // ========================================
    // --- 1. CONFIGURATION FIREBASE ---
    // ========================================
    const firebaseConfig = {
        apiKey: "AIzaSyCoTQOSNy-9EcpEncFprbEjCqa7lCGkRHs",
        authDomain: "quiz-feux-follets.firebaseapp.com",
        projectId: "quiz-feux-follets",
        storageBucket: "quiz-feux-follets.firebasestorage.app",
        messagingSenderId: "294811125482",
        appId: "1:294811125482:web:9a1565ed6b9e76d286f993"
    };

    let db = null;

    // Initialisation Firebase avec gestion d'erreur
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("‚úì initialis√© avec succ√®s");
        updateFirebaseStatus("connect√©", true);
    } catch (error) {
        console.error("‚úó Erreur Firebase:", error);
        updateFirebaseStatus(`Erreur: ${error.message}`, false);
        db = null;
    }

    // ========================================
    // --- 2. DONN√âES DU QUIZ ---
    // ========================================
    const questions = [
        { 
            q: "Quelle est la mission principale de l'association ¬´ Les Feux Follets ¬ª ?", 
            options: [
                "Financer la recherche sur le cancer.",
                "Soutenir les parents et adultes atteints de PCU et d'autres maladies m√©taboliques.",
                "Organiser des collectes de sang.",
                "Promouvoir le sport pour tous."
            ], 
            answer: 1 
        },
        { 
            q: "En quelle ann√©e le d√©pistage syst√©matique de la PCU a-t-il √©t√© introduit en France ?", 
            options: ["1965", "1972", "1980", "1995"], 
            answer: 1 
        },
        { 
            q: "Quelle est l'origine biologique de la ph√©nylc√©tonurie ?", 
            options: [
                "Une carence en vitamines durant la grossesse.",
                "Une infection bact√©rienne n√©onatale.",
                "Une anomalie g√©n√©tique du m√©tabolisme de la ph√©nylalanine.",
                "Une allergie alimentaire s√©v√®re au gluten."
            ], 
            answer: 2 
        },
        { 
            q: "Quel est le pilier central du traitement de la PCU ?", 
            options: [
                "Une activit√© physique intensive quotidienne.",
                "Un r√©gime alimentaire pauvre en prot√©ines (ph√©nylalanine).",
                "Un traitement antibiotique √† vie.",
                "Une greffe de foie syst√©matique."
            ], 
            answer: 1 
        },
        { 
            q: "Quels aliments sont g√©n√©ralement exclus ou strictement limit√©s dans le r√©gime PCU ?", 
            options: [
                "Les fruits et les l√©gumes.",
                "Les huiles et les sucres.",
                "La viande, le poisson et les ≈ìufs.",
                "L'eau min√©rale et les infusions."
            ], 
            answer: 2 
        },
        { 
            q: "Quel additif alimentaire est strictement interdit car il contient de la ph√©nylalanine ?", 
            options: [
                "Le sel de table.",
                "L'aspartame.",
                "La l√©cithine de soja.",
                "Le bicarbonate de soude."
            ], 
            answer: 1 
        },
        { 
            q: "Quel est l'objectif de taux sanguin de ph√©nylalanine pour un enfant de moins de 12 ans ?", 
            options: [
                "Entre 120 et 360 ¬µmol/L.",
                "Entre 600 et 900 ¬µmol/L.",
                "Moins de 50 ¬µmol/L.",
                "Plus de 1000 ¬µmol/L."
            ], 
            answer: 0 
        },
        { 
            q: "Qu'est-ce que le Kuvan¬Æ (sapropt√©rine) ?", 
            options: [
                "Un substitut de lait sans prot√©ines.",
                "Une application mobile pour calculer les repas.",
                "Un m√©dicament augmentant la tol√©rance √† la ph√©nylalanine chez certains patients.",
                "Un test de d√©pistage urinaire."
            ], 
            answer: 2 
        },
        { 
            q: "Quel est le risque pour le f≈ìtus d'une femme enceinte atteinte de PCU si ses taux ne sont pas strictement contr√¥l√©s ?", 
            options: [
                "Une coloration anormale des cheveux.",
                "L'embryof≈ìtopathie ph√©nylc√©tonurique (malformations cardiaques, microc√©phalie).",
                "Une allergie imm√©diate aux fruits.",
                "Aucun risque n'a √©t√© identifi√©."
            ], 
            answer: 1 
        },
        { 
            q: "Comment s'effectue g√©n√©ralement le contr√¥le r√©gulier des taux de ph√©nylalanine √† domicile ?", 
            options: [
                "Par un test salivaire.",
                "Par une pes√©e quotidienne.",
                "Par un pr√©l√®vement de sang sur un carton buvard (test de Guthrie).",
                "Par une analyse d'haleine."
            ], 
            answer: 2 
        }
    ];

    // ========================================
    // --- 3. VARIABLES DE SUIVI ---
    // ========================================
    let currentQuestionIndex = 0;
    let score = 0;
    let hasAnswered = false;

    // ========================================
    // --- 4. GESTION FIREBASE STATUS ---
    // ========================================
    function updateFirebaseStatus(message, isSuccess) {
        const statusContainer = document.getElementById('firebase-status-container');
        if (isSuccess) {
            statusContainer.innerHTML = `<div class="firebase-status status-success">‚úÖ ${message}</div>`;
        } else {
            statusContainer.innerHTML = `<div class="firebase-status status-error">‚ö†Ô∏è ${message}</div>`;
        }
    }

    // ========================================
    // --- 5. FEU D'ARTIFICE (CONFETTI) ---
    // ========================================
    function fireConfetti() {
        const myColors = ['#f39200', '#ffc107', '#003a5d'];
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: myColors
        });
    }

    // ========================================
    // --- 6. D√âMARRAGE DU QUIZ ---
    // ========================================
    function startQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        hasAnswered = false;
        document.getElementById('welcome-block').classList.add('hidden');
        document.getElementById('quiz-block').classList.remove('hidden');
        loadQuestion();
    }

    // ========================================
    // --- 7. CHARGEMENT DES QUESTIONS ---
    // ========================================
    function loadQuestion() {
        hasAnswered = false;
        document.getElementById('next-btn').style.display = "none";
        
        const q = questions[currentQuestionIndex];
        document.getElementById('progress-text').innerText = 
            `Question ${currentQuestionIndex + 1} sur ${questions.length}`;
        document.getElementById('question-text').innerText = q.q;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = "";

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerText = opt;
            btn.onclick = () => selectOption(btn, index);
            optionsContainer.appendChild(btn);
        });
    }

    // ========================================
    // --- 8. S√âLECTION D'UNE R√âPONSE ---
    // ========================================
    function selectOption(clickedBtn, selectedIndex) {
        if (hasAnswered) return;
        hasAnswered = true;

        const q = questions[currentQuestionIndex];
        const buttons = document.querySelectorAll('.option-btn');
        
        if (selectedIndex === q.answer) {
            // Bonne r√©ponse
            clickedBtn.classList.add('correct', 'animate-correct');
            score++;
            fireConfetti();
        } else {
            // Mauvaise r√©ponse
            clickedBtn.classList.add('incorrect', 'animate-incorrect');
            buttons[q.answer].classList.add('correct');
        }

        // D√©sactiver tous les boutons
        buttons.forEach(btn => btn.disabled = true);
        
        // Afficher bouton "Suivant"
        document.getElementById('next-btn').style.display = "inline-block";
    }

    // ========================================
    // --- 9. QUESTION SUIVANTE ---
    // ========================================
    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    // ========================================
    // --- 10. AFFICHAGE DES R√âSULTATS ---
    // ========================================
    function showResults() {
        document.getElementById('quiz-block').classList.add('hidden');
        document.getElementById('result-block').classList.remove('hidden');
        
        document.getElementById('score-final').innerText = `Score : ${score} / ${questions.length}`;
        
        const feedback = document.getElementById('feedback-text');
        const trophy = document.getElementById('trophy-emoji');
        
        if (score === 10) {
            feedback.innerText = "üåü Incroyable ! Vous √™tes un expert absolu des Feux Follets !";
            trophy.innerText = "üëëüèÜüëë";
            fireConfetti();
        } else if (score >= 8) {
            feedback.innerText = "üéØ Excellent travail ! Vous ma√Ætrisez tr√®s bien le sujet.";
            trophy.innerText = "ü•á Or";
        } else if (score >= 5) {
            feedback.innerText = "üëç Bien jou√© ! Vous avez de bonnes connaissances.";
            trophy.innerText = "ü•à Argent";
        } else {
            feedback.innerText = "üí™ Merci pour votre participation ! L'important est d'apprendre.";
            trophy.innerText = "ü•â Bronze";
        }
    }

    // ========================================
    // --- 11. SAUVEGARDE DU SCORE FIREBASE ---
    // ========================================
    function saveScoreToFirebase() {
        const playerName = document.getElementById('player-name').value.trim();
        const saveBtn = document.getElementById('save-btn');
        const saveStatus = document.getElementById('save-status');

        // Validation du nom
        if (!playerName) {
            saveStatus.innerHTML = '<span style="color: #c00; font-weight: bold;">‚ùå Merci d\'entrer un nom !</span>';
            document.getElementById('player-name').focus();
            return;
        }

        if (playerName.length < 2) {
            saveStatus.innerHTML = '<span style="color: #c00; font-weight: bold;">‚ùå Le nom doit contenir au moins 2 caract√®res !</span>';
            return;
        }

        // D√©sactiver le bouton
        saveBtn.disabled = true;
        saveBtn.innerText = "‚è≥ Sauvegarde en cours...";
        saveStatus.innerHTML = '';

        // V√©rifier si Firebase est disponible
        if (!db) {
            setTimeout(() => {
                saveStatus.innerHTML = `<span style="color: var(--correct-green); font-weight: bold;">‚ö†Ô∏è Mode simulation : Score de ${score}/10 enregistr√© pour ${playerName}</span>`;
                saveBtn.innerText = "üíæ Sauvegarder le score";
                saveBtn.disabled = false;
                updateFirebaseStatus("Pas de connexion active", false);
            }, 1000);
            return;
        }

        // Sauvegarder dans Firestore
        db.collection("hospital_scores").add({
            name: playerName,
            score: parseInt(score),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            console.log(`‚úì Score sauvegard√©: ${playerName} - ${score}/10`);
            saveStatus.innerHTML = '<span style="color: var(--correct-green); font-weight: bold; font-size: 1.1em;">üéâ Score enregistr√© avec succ√®s !</span>';
            saveBtn.disabled = true;
            saveBtn.innerText = "‚úÖ Score enregistr√©";
            document.getElementById('player-name').disabled = true;
            updateFirebaseStatus("Score sauvegard√©", true);
        })
        .catch((error) => {
            console.error("‚ùå Erreur Firestore:", error);
            saveStatus.innerHTML = `<span style="color: #c00; font-weight: bold;">‚ùå Erreur: ${error.message}</span>`;
            saveBtn.disabled = false;
            saveBtn.innerText = "üîÑ R√©essayer la sauvegarde";
            updateFirebaseStatus(`Erreur: ${error.code}`, false);
        });
    }

    // ========================================
    // --- 12. TEST DE CONNEXION AU CHARGEMENT ---
    // ========================================
    window.addEventListener('load', () => {
        console.log("üöÄ Page Quiz charg√©e");
        
        if (db) {
            db.collection("hospital_scores").limit(1).get()
                .then(() => {
                    console.log("‚úì Connexion Firestore OK");
                    updateFirebaseStatus("connect√©", true);
                })
                .catch((error) => {
                    console.error("‚úó Erreur de connexion:", error);
                    updateFirebaseStatus(`Erreur de connexion: ${error.code}`, false);
                });
        }
    });

    // Permettre ENTR√âE pour valider le nom
    document.addEventListener('DOMContentLoaded', () => {
        const playerNameInput = document.getElementById('player-name');
        if (playerNameInput) {
            playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveScoreToFirebase();
                }
            });
        }
    });
</script>

</body>
</html>
