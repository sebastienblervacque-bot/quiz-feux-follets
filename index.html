<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz : Les Feux Follets & La Ph√©nylc√©tonurie</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-orange: #f39200;
            --secondary-yellow: #ffc107;
            --dark-blue: #003a5d;
            --light-bg: #fdfaf6;
            --correct-green: #28a745;
            --wrong-red: #dc3545;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .quiz-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 30px;
            text-align: center;
            border-top: 8px solid var(--primary-orange);
            position: relative;
        }

        h1 {
            color: var(--dark-blue);
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        /* Accueil et QR */
        .welcome-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .qr-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed var(--primary-orange);
        }
        .qr-box img {
            max-width: 150px;
            height: auto;
        }
        .qr-instruction {
            font-size: 0.9em;
            color: var(--dark-blue);
            margin-top: 10px;
            font-weight: bold;
        }

        /* Quiz */
        .question {
            font-size: 1.3em;
            font-weight: bold;
            margin: 30px 0 20px 0;
            color: var(--dark-blue);
            min-height: 60px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background-color: white;
            border: 2px solid var(--primary-orange);
            color: var(--dark-blue);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.2s ease-in-out;
            position: relative;
        }

        .option-btn:not(:disabled):hover {
            background-color: var(--secondary-yellow);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Couleurs et Animations de r√©ponse */
        .option-btn.correct {
            background-color: var(--correct-green) !important;
            color: white !important;
            border-color: var(--correct-green) !important;
        }
        
        .option-btn.animate-correct {
            animation: pulse-green 0.6s ease-out;
        }

        @keyframes pulse-green {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); box-shadow: 0 0 15px var(--correct-green); }
            100% { transform: scale(1); }
        }

        .option-btn.incorrect {
            background-color: var(--wrong-red) !important;
            color: white !important;
            border-color: var(--wrong-red) !important;
        }

        .option-btn.animate-incorrect {
            animation: shake-red 0.5s ease-in-out;
        }

        @keyframes shake-red {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-6px); }
            40%, 80% { transform: translateX(6px); }
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        .action-btn {
            background-color: var(--dark-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            margin-top: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .action-btn:hover {
            background-color: #00223e;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .hidden { display: none !important; }

        .trophy { font-size: 100px; margin: 20px 0; }

        input[type="text"] {
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 80%;
            margin-top: 15px;
            transition: 0.3s;
        }
        input[type="text"]:focus {
            border-color: var(--primary-orange);
            outline: none;
        }
        
        .progress {
            font-size: 0.9em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

<div class="quiz-container">
    
    <div id="welcome-block" class="welcome-content">
        <h1>üî• Les Feux Follets</h1>
        <p class="subtitle">Animation H√¥pital : Le grand quiz sur la PCU</p>

        <div class="qr-box">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://sebastienblervacque-bot.github.io/quiz-feux-follets/" alt="QR Code du Quiz">
            <p class="qr-instruction">Scannez pour jouer sur votre mobile !</p>
        </div>

        <p>Testez vos connaissances et tentez de remporter le troph√©e d'or !</p>
        <button class="action-btn" onclick="startQuiz()">Commencer le Quiz</button>
    </div>

    <div id="quiz-block" class="hidden">
        <div class="progress" id="progress-text">Question 1 / 10</div>
        <div class="question" id="question-text">Chargement...</div>
        <div class="options" id="options-container"></div>
        <button id="next-btn" class="action-btn" style="display:none;" onclick="nextQuestion()">Question suivante ‚ûî</button>
    </div>

    <div id="result-block" class="hidden">
        <h2>Quiz Termin√© !</h2>
        <div class="trophy" id="trophy-emoji">üèÜ</div>
        <h1 id="score-final">Score: 0/10</h1>
        <p id="feedback-text" style="font-size: 1.2em; margin: 20px 0;"></p>
        
        <div id="firebase-save-block" style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 20px;">
            <p style="margin-top:0; font-weight: bold; color: var(--dark-blue);">Inscrire mon score au tableau d'honneur :</p>
            <input type="text" id="player-name" placeholder="Votre pr√©nom ou pseudo">
            <br>
            <button id="save-btn" class="action-btn" onclick="saveScoreToFirebase()">Sauvegarder</button>
        </div>
        <button class="action-btn" style="background-color: #666; margin-top: 30px;" onclick="location.reload()">üîÑ Rejouer</button>
    </div>
</div>

<script>
    // --- CONFIGURATION FIREBASE ---
    const firebaseConfig = {
	  apiKey: "AIzaSyCoTQOSNy-9EcpEncFprbEjCqa7lCGkRHs",
	  authDomain: "quiz-feux-follets.firebaseapp.com",
	  projectId: "quiz-feux-follets",
	  storageBucket: "quiz-feux-follets.firebasestorage.app",
	  messagingSenderId: "294811125482",
	  appId: "1:294811125482:web:9a1565ed6b9e76d286f993"
    };

     firebase.initializeApp(firebaseConfig);
     const db = firebase.firestore();

    // --- DONN√âES DU QUIZ ---
    const questions = [
        { q: "Quelle est la mission principale de l'association ¬´ Les Feux Follets ¬ª ?", options: ["Financer la recherche sur le cancer.", "Soutenir les parents et adultes atteints de PCU et d'autres maladies m√©taboliques.", "Organiser des collectes de sang.", "Promouvoir le sport pour tous."], answer: 1 },
        { q: "En quelle ann√©e le d√©pistage syst√©matique de la PCU a-t-il √©t√© introduit en France ?", options: ["1965", "1972", "1980", "1995"], answer: 1 },
        { q: "Quelle est l'origine biologique de la ph√©nylc√©tonurie ?", options: ["Une carence en vitamines durant la grossesse.", "Une infection bact√©rienne n√©onatale.", "Une anomalie g√©n√©tique du m√©tabolisme de la ph√©nylalanine.", "Une allergie alimentaire s√©v√®re au gluten."], answer: 2 },
        { q: "Quel est le pilier central du traitement de la PCU ?", options: ["Une activit√© physique intensive quotidienne.", "Un r√©gime alimentaire pauvre en prot√©ines (ph√©nylalanine).", "Un traitement antibiotique √† vie.", "Une greffe de foie syst√©matique."], answer: 1 },
        { q: "Quels aliments sont g√©n√©ralement exclus ou strictement limit√©s dans le r√©gime PCU ?", options: ["Les fruits et les l√©gumes.", "Les huiles et les sucres.", "La viande, le poisson et les ≈ìufs.", "L'eau min√©rale et les infusions."], answer: 2 },
        { q: "Quel additif alimentaire est strictement interdit car il contient de la ph√©nylalanine ?", options: ["Le sel de table.", "L'aspartame.", "La l√©cithine de soja.", "Le bicarbonate de soude."], answer: 1 },
        { q: "Quel est l'objectif de taux sanguin de ph√©nylalanine pour un enfant de moins de 12 ans ?", options: ["Entre 120 et 360 ¬µmol/L.", "Entre 600 et 900 ¬µmol/L.", "Moins de 50 ¬µmol/L.", "Plus de 1000 ¬µmol/L."], answer: 0 },
        { q: "Qu'est-ce que le Kuvan¬Æ (sapropt√©rine) ?", options: ["Un substitut de lait sans prot√©ines.", "Une application mobile pour calculer les repas.", "Un m√©dicament augmentant la tol√©rance √† la ph√©nylalanine chez certains patients.", "Un test de d√©pistage urinaire."], answer: 2 },
        { q: "Quel est le risque pour le f≈ìtus d'une femme enceinte atteinte de PCU si ses taux ne sont pas strictement contr√¥l√©s ?", options: ["Une coloration anormale des cheveux.", "L'embryof≈ìtopathie ph√©nylc√©tonurique (malformations cardiaques, microc√©phalie).", "Une allergie imm√©diate aux fruits.", "Aucun risque n'a √©t√© identifi√©."], answer: 1 },
        { q: "Comment s'effectue g√©n√©ralement le contr√¥le r√©gulier des taux de ph√©nylalanine √† domicile ?", options: ["Par un test salivaire.", "Par une pes√©e quotidienne.", "Par un pr√©l√®vement de sang sur un carton buvard (test de Guthrie).", "Par une analyse d'haleine."], answer: 2 }
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let hasAnswered = false;

    // Fonction de d√©clenchement du feu d'artifice
    function fireConfetti() {
        // Couleurs de l'asso : Orange, Jaune, Bleu
        var myColors = ['#f39200', '#ffc107', '#003a5d'];
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: myColors
        });
    }

    function startQuiz() {
        document.getElementById('welcome-block').classList.add('hidden');
        document.getElementById('quiz-block').classList.remove('hidden');
        loadQuestion();
    }

    function loadQuestion() {
        hasAnswered = false;
        document.getElementById('next-btn').style.display = "none";
        
        const q = questions[currentQuestionIndex];
        document.getElementById('progress-text').innerText = `QUESTION ${currentQuestionIndex + 1} SUR ${questions.length}`;
        document.getElementById('question-text').innerText = q.q;
        
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = "";

        q.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = "option-btn";
            btn.innerHTML = `<span>${opt}</span>`;
            btn.onclick = () => selectOption(btn, index);
            optionsContainer.appendChild(btn);
        });
    }

    function selectOption(clickedBtn, selectedIndex) {
        if (hasAnswered) return;
        hasAnswered = true;

        const q = questions[currentQuestionIndex];
        const buttons = document.querySelectorAll('.option-btn');
        
        if (selectedIndex === q.answer) {
            clickedBtn.classList.add('correct', 'animate-correct');
            score++;
            fireConfetti(); // <-- D√âCLENCHEMENT DU FEU D'ARTIFICE
        } else {
            clickedBtn.classList.add('incorrect', 'animate-incorrect');
            buttons[q.answer].classList.add('correct'); 
        }

        buttons.forEach(btn => btn.disabled = true);
        document.getElementById('next-btn').style.display = "inline-block";
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            loadQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('quiz-block').classList.add('hidden');
        document.getElementById('result-block').classList.remove('hidden');
        
        document.getElementById('score-final').innerText = `Score : ${score} / ${questions.length}`;
        
        const feedback = document.getElementById('feedback-text');
        const trophy = document.getElementById('trophy-emoji');
        
        if (score === 10) {
            feedback.innerText = "Incroyable ! Vous √™tes un expert absolu des Feux Follets !";
            trophy.innerText = "üëëüèÜüëë";
            fireConfetti(); // Feu d'artifice final pour le score parfait !
        } else if (score >= 8) {
            feedback.innerText = "Excellent travail ! Vous ma√Ætrisez tr√®s bien le sujet.";
            trophy.innerText = "ü•á Or";
        } else if (score >= 5) {
            feedback.innerText = "Bien jou√© ! Vous avez de bonnes connaissances.";
            trophy.innerText = "ü•à Argent";
        } else {
            feedback.innerText = "Merci pour votre participation ! L'important est d'apprendre.";
            trophy.innerText = "ü•â Bronze";
        }
    }

    function saveScoreToFirebase() {
        const playerName = document.getElementById('player-name').value;
        const saveBtn = document.getElementById('save-btn');

        if (!playerName) {
            alert("Merci d'entrer un nom !");
            return;
        }

        saveBtn.disabled = true;
        saveBtn.innerText = "Sauvegarde en cours...";

        if(typeof db === 'undefined') {
            setTimeout(() => {
                alert(`‚ö†Ô∏è Mode Simulation : Bravo ${playerName}, score de ${score} m√©moris√© ! (Activez Firebase pour de vrai)`);
                document.getElementById('firebase-save-block').innerHTML = "<p style='color:var(--correct-green); font-weight:bold; text-align:center;'>‚úÖ Score enregistr√© (simulation) !</p>";
            }, 1000);
            return;
        }

        db.collection("hospital_scores").add({
            name: playerName,
            score: score,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            document.getElementById('firebase-save-block').innerHTML = "<p style='color:var(--correct-green); font-weight:bold; text-align:center; font-size:1.2em;'>üéâ Score enregistr√© avec succ√®s ! Merci !</p>";
        })
        .catch((error) => {
            console.error("Erreur : ", error);
            saveBtn.disabled = false;
            saveBtn.innerText = "R√©essayer la sauvegarde";
            alert("Oups, une erreur est survenue. V√©rifiez la connexion.");
        });
    }
</script>

</body>
</html>